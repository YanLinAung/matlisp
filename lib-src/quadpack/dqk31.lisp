;;; Compiled by f2cl version 2.0 beta on 2001/02/23 at 10:08:51
;;; 
;;; Options: ((:prune-labels nil) (:auto-save t) (:relaxed-array-decls t)
;;;           (:coerce-assigns :as-needed) (:array-type 'simple-array)
;;;           (:array-slicing t))


(use-package :f2cl)

(let ((wg (make-array 8 :element-type 'double-float))
      (xgk (make-array 16 :element-type 'double-float))
      (wgk (make-array 16 :element-type 'double-float)))
  (declare (type (array double-float (16)) wgk xgk)
           (type (array double-float (8)) wg))
  (fset (fref wg (1) ((1 8))) 0.03075324199611727d0)
  (fset (fref wg (2) ((1 8))) 0.07036604748810812d0)
  (fset (fref wg (3) ((1 8))) 0.10715922046717194d0)
  (fset (fref wg (4) ((1 8))) 0.13957067792615432d0)
  (fset (fref wg (5) ((1 8))) 0.16626920581699392d0)
  (fset (fref wg (6) ((1 8))) 0.1861610000155622d0)
  (fset (fref wg (7) ((1 8))) 0.19843148532711158d0)
  (fset (fref wg (8) ((1 8))) 0.2025782419255613d0)
  (fset (fref xgk (1) ((1 16))) 0.9980022986933971d0)
  (fset (fref xgk (2) ((1 16))) 0.9879925180204854d0)
  (fset (fref xgk (3) ((1 16))) 0.9677390756791391d0)
  (fset (fref xgk (4) ((1 16))) 0.937273392400706d0)
  (fset (fref xgk (5) ((1 16))) 0.8972645323440819d0)
  (fset (fref xgk (6) ((1 16))) 0.8482065834104272d0)
  (fset (fref xgk (7) ((1 16))) 0.790418501442466d0)
  (fset (fref xgk (8) ((1 16))) 0.7244177313601701d0)
  (fset (fref xgk (9) ((1 16))) 0.650996741297417d0)
  (fset (fref xgk (10) ((1 16))) 0.5709721726085388d0)
  (fset (fref xgk (11) ((1 16))) 0.4850818636402397d0)
  (fset (fref xgk (12) ((1 16))) 0.3941513470775634d0)
  (fset (fref xgk (13) ((1 16))) 0.29918000715316884d0)
  (fset (fref xgk (14) ((1 16))) 0.20119409399743451d0)
  (fset (fref xgk (15) ((1 16))) 0.1011420669187175d0)
  (fset (fref xgk (16) ((1 16))) 0.0d0)
  (fset (fref wgk (1) ((1 16))) 0.005377479872923349d0)
  (fset (fref wgk (2) ((1 16))) 0.015007947329316122d0)
  (fset (fref wgk (3) ((1 16))) 0.02546084732671532d0)
  (fset (fref wgk (4) ((1 16))) 0.03534636079137585d0)
  (fset (fref wgk (5) ((1 16))) 0.04458975132476488d0)
  (fset (fref wgk (6) ((1 16))) 0.05348152469092809d0)
  (fset (fref wgk (7) ((1 16))) 0.06200956780067064d0)
  (fset (fref wgk (8) ((1 16))) 0.06985412131872826d0)
  (fset (fref wgk (9) ((1 16))) 0.07684968075772038d0)
  (fset (fref wgk (10) ((1 16))) 0.08308050282313302d0)
  (fset (fref wgk (11) ((1 16))) 0.08856444305621176d0)
  (fset (fref wgk (12) ((1 16))) 0.09312659817082532d0)
  (fset (fref wgk (13) ((1 16))) 0.09664272698362368d0)
  (fset (fref wgk (14) ((1 16))) 0.09917359872179196d0)
  (fset (fref wgk (15) ((1 16))) 0.10076984552387559d0)
  (fset (fref wgk (16) ((1 16))) 0.10133000701479154d0)
  (defun dqk31 (f a b result abserr resabs resasc)
    (declare (type double-float a b result abserr resabs resasc)
             (type (function (double-float) (values double-float &rest t)) f))
    (prog ((j 0) (jtw 0) (jtwm1 0) (uflow 0.0d0) (reskh 0.0d0) (resk 0.0d0)
           (resg 0.0d0) (hlgth 0.0d0)
           (fv2 (make-array 15 :element-type 'double-float))
           (fv1 (make-array 15 :element-type 'double-float)) (fval2 0.0d0)
           (fval1 0.0d0) (fsum 0.0d0) (fc 0.0d0) (epmach 0.0d0) (dhlgth 0.0d0)
           (centr 0.0d0) (absc 0.0d0))
      (declare (type (array double-float (15)) fv1 fv2)
               (type double-float absc centr dhlgth epmach fc fsum fval1 fval2
                hlgth resg resk reskh uflow)
               (type integer4 jtwm1 jtw j))
      (declare
       (ftype (function (integer4) (values double-float &rest t)) d1mach))
      (declare (ftype (function (double-float) (values double-float)) dabs))
      (declare
       (ftype (function (double-float double-float) (values double-float))
        dmin1))
      (declare
       (ftype (function (double-float double-float) (values double-float))
        dmax1))
      (setf epmach (d1mach 4))
      (setf uflow (d1mach 1))
      (setf centr (* 0.5d0 (+ a b)))
      (setf hlgth (* 0.5d0 (- b a)))
      (setf dhlgth (dabs hlgth))
      (setf fc
              (coerce
               (multiple-value-bind
                   (ret-val var-0)
                   (funcall f centr)
                 (declare (ignore))
                 (when var-0 (setf centr var-0))
                 ret-val)
               'double-float))
      (setf resg (* (fref wg (8) ((1 8))) fc))
      (setf resk (* (fref wgk (16) ((1 16))) fc))
      (setf resabs (dabs resk))
      (fdo (j 1 (+ j 1))
           ((> j 7) nil)
           (tagbody
             (setf jtw (* j 2))
             (setf absc (* hlgth (fref xgk (jtw) ((1 16)))))
             (setf fval1 (funcall f (- centr absc)))
             (setf fval2 (funcall f (+ centr absc)))
             (fset (fref fv1 (jtw) ((1 15))) fval1)
             (fset (fref fv2 (jtw) ((1 15))) fval2)
             (setf fsum (+ fval1 fval2))
             (setf resg (+ resg (* (fref wg (j) ((1 8))) fsum)))
             (setf resk (+ resk (* (fref wgk (jtw) ((1 16))) fsum)))
             (setf resabs
                     (+ resabs
                        (* (fref wgk (jtw) ((1 16)))
                           (+ (dabs fval1) (dabs fval2)))))
            label10))
      (fdo (j 1 (+ j 1))
           ((> j 8) nil)
           (tagbody
             (setf jtwm1 (- (* j 2) 1))
             (setf absc (* hlgth (fref xgk (jtwm1) ((1 16)))))
             (setf fval1 (funcall f (- centr absc)))
             (setf fval2 (funcall f (+ centr absc)))
             (fset (fref fv1 (jtwm1) ((1 15))) fval1)
             (fset (fref fv2 (jtwm1) ((1 15))) fval2)
             (setf fsum (+ fval1 fval2))
             (setf resk (+ resk (* (fref wgk (jtwm1) ((1 16))) fsum)))
             (setf resabs
                     (+ resabs
                        (* (fref wgk (jtwm1) ((1 16)))
                           (+ (dabs fval1) (dabs fval2)))))
            label15))
      (setf reskh (* resk 0.5d0))
      (setf resasc (* (fref wgk (16) ((1 16))) (dabs (- fc reskh))))
      (fdo (j 1 (+ j 1))
           ((> j 15) nil)
           (tagbody
             (setf resasc
                     (+ resasc
                        (* (fref wgk (j) ((1 16)))
                           (+ (dabs (- (fref fv1 (j) ((1 15))) reskh))
                              (dabs (- (fref fv2 (j) ((1 15))) reskh))))))
            label20))
      (setf result (* resk hlgth))
      (setf resabs (* resabs dhlgth))
      (setf resasc (* resasc dhlgth))
      (setf abserr (dabs (* (- resk resg) hlgth)))
      (if (and (/= resasc 0.0d0) (/= abserr 0.0d0))
          (setf abserr
                  (* resasc
                     (dmin1 1.0d0
                            (expt (/ (* 200.0d0 abserr) resasc) 1.5d0)))))
      (if (> resabs (/ uflow (* 50.0d0 epmach)))
          (setf abserr (dmax1 (* epmach 50.0d0 resabs) abserr)))
      (go end_label)
     end_label
      (return (values f a b result abserr resabs resasc)))))

